<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Plex Services Sample Form</title>
    <style>
        :root {
            --primary-color: #f28c38;
            --secondary-color: #f5f6fa;
            --text-color: #2d3748;
            --accent-color: #fff5e6;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 1280px;
            margin: 40px auto;
            padding: 30px;
            background: linear-gradient(135deg, #fff5e6 0%, #ffffff 100%);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        }
        h1 {
            color: var(--primary-color);
            text-align: center;
            font-size: 2.8em;
            margin-bottom: 30px;
            font-weight: 700;
            text-transform: uppercase;
            background: linear-gradient(to right, var(--primary-color), #f7b731);
            -webkit-background-clip: text;
            color: transparent;
        }
        h2 {
            color: var(--text-color);
            font-size: 1.9em;
            margin: 40px 0 20px;
            text-align: center;
            position: relative;
            font-weight: 600;
        }
        h2::after {
            content: '';
            width: 60px;
            height: 3px;
            background: var(--primary-color);
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }
        h3 {
            color: var(--text-color);
            font-size: 1.3em;
            margin: 20px 0 10px;
            font-weight: 500;
        }
        form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 20px;
            background: var(--secondary-color);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        label {
            display: flex;
            flex-direction: column;
            font-size: 0.95em;
            font-weight: 500;
            color: var(--text-color);
        }
        input[type="text"], input[type="email"], select, textarea {
            padding: 12px;
            margin-top: 6px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #fff;
            font-size: 0.9em;
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px rgba(242, 140, 56, 0.3);
            background: var(--accent-color);
            outline: none;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .row-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .eval-section {
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 30px 0;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 18px rgba(0,0,0,0.1);
        }
        table:hover {
            transform: translateY(-3px);
        }
        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #edf2f7;
        }
        th {
            background: linear-gradient(135deg, var(--primary-color), #f7b731);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.95em;
        }
        td {
            background: #ffffff;
            color: var(--text-color);
        }
        tr:nth-child(even) td {
            background: var(--secondary-color);
        }
        tr:hover td {
            background: var(--accent-color);
        }
        input[type="text"], select {
            width: 100%;
            border: none;
            background: transparent;
            padding: 6px;
            font-size: 0.9em;
            color: var(--text-color);
        }
        .note-section {
            background: var(--secondary-color);
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            border-left: 4px solid var(--primary-color);
        }
        .note-section p {
            margin: 10px 0;
            line-height: 1.8;
            color: var(--text-color);
            font-size: 0.95em;
        }
        footer {
            margin-top: 50px;
            text-align: center;
            color: #718096;
            font-size: 0.9em;
            padding: 20px 0;
            border-top: 1px solid #e2e8f0;
            background: var(--secondary-color);
            border-radius: 8px;
        }
        .button {
            display: inline-block;
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            margin: 10px;
        }
        .button:hover {
            background: #e07b39;
            transform: translateY(-2px);
        }
        .button.delete {
            background: #e53e3e;
        }
        .button.delete:hover {
            background: #c53030;
        }
        .hidden {
            display: none;
        }
        @media (max-width: 768px) {
            body { padding: 15px; margin: 20px; }
            form { grid-template-columns: 1fr; }
            .row-container { grid-template-columns: 1fr; }
            h1 { font-size: 2.2em; }
            h2 { font-size: 1.6em; }
            h3 { font-size: 1.2em; }
            table, th, td, input, select { font-size: 0.85em; }
        }
    </style>
</head>
<body>
    <h1>Simple Plex Services Sample Information</h1>

    <h2>Basic Information</h2>
    <form id="plexForm">
        <label>Service ID:
            <select name="Service ID" id="service_id" required>
                <option value="">Select Service ID</option>
                <option value="SPCKB-PS-72-1">SPCKB-PS-72-1</option>
                <option value="SPCKA-PS-16-1">SPCKA-PS-16-1</option>
                <option value="SPCKA-PS-16-2">SPCKA-PS-16-2</option>
                <option value="SPCKA-PS-16-3">SPCKA-PS-16-3</option>
                <option value="SPCKA-PS-16-4">SPCKA-PS-16-4</option>
                <option value="SPCKC-PS-32-1">SPCKC-PS-32-1</option>
                <option value="SPCKC-PS-32-2">SPCKC-PS-32-2</option>
                <option value="SPCKC-PS-32-3">SPCKC-PS-32-3</option>
                <option value="SPCKC-PS-32-4">SPCKC-PS-32-4</option>
                <option value="SPCKE-PS-32-5">SPCKE-PS-32-5</option>
                <option value="SPCKE-PS-32-6">SPCKE-PS-32-6</option>
                <option value="SPCKE-PS-32-7">SPCKE-PS-32-7</option>
                <option value="SPCKE-PS-32-8">SPCKE-PS-32-8</option>
                <option value="SPCK-PANEL-CUSTOM">SPCK-PANEL-CUSTOM</option>
            </select>
        </label>
        <label>Phone Number: <input type="text" name="Phone Number" placeholder="Enter Phone Number" required></label>
        <label>Email: <input type="email" name="Email" placeholder="Enter Email" required></label>
        <label>Surname: <input type="text" name="Surname" placeholder="Enter Surname" required></label>
        <label>Given Name: <input type="text" name="Given Name" placeholder="Enter Given Name" required></label>
        <label>Principal Investigator: <input type="text" name="Principal Investigator" placeholder="Enter Principal Investigator"></label>
        <label>Institute:
            <select name="Institute" id="institute" required>
                <option value="">Select Institute</option>
                <option value="CUHK">CUHK</option>
                <option value="HKU">HKU</option>
                <option value="HKUST">HKUST</option>
                <option value="POLYU">POLYU</option>
                <option value="HKBU">HKBU</option>
                <option value="CITYU">CITYU</option>
                <option value="Others">Others (Please specify)</option>
            </select>
            <input type="text" id="institute_other" name="Institute_Other" placeholder="Specify if Others" class="hidden mt-2">
        </label>
        <label>Lab Address: <input type="text" name="Lab Address" placeholder="Enter Lab Address" required></label>
        <label>Sales Representative:
            <select name="Sales Representative" required>
                <option value="">Select Sales Representative</option>
                <option value="Yanny MAN">Yanny MAN</option>
                <option value="Allen HU">Allen HU</option>
                <option value="Hasily LIU">Hasily LIU</option>
                <option value="Leo DU">Leo DU</option>
                <option value="Joe LAI">Joe LAI</option>
                <option value="Leon LI">Leon LI</option>
            </select>
        </label>
    </form>

    <h2>Evaluation Part</h2>
    <form id="evaluationForm">
        <div class="eval-section">
            <h3>Configuration</h3>
            <label>Workflow Configuration: <input type="text" name="Configuration" placeholder="Specify configuration"></label>
        </div>
        <div class="eval-section">
            <h3>Quantitative Metrics</h3>
            <div class="row-container">
                <label>Expected Concentration Range: <input type="text" name="Concentration Range" placeholder="Enter concentration range"></label>
                <label>Current CV%: <input type="text" name="Current CV%" placeholder="Enter CV%"></label>
                <label>Expected Recovery %: <input type="text" name="Expected Recovery %" placeholder="Enter recovery %"></label>
                <label>Current LLOQ: <input type="text" name="Current LLOQ" placeholder="Enter LLOQ"></label>
            </div>
        </div>
        <div class="eval-section">
            <h3>Sample Details</h3>
            <div class="row-container">
                <label>Endogenous Levels: <textarea name="Endogenous Levels" placeholder="Enter endogenous levels"></textarea></label>
                <label>Sample Preparation: <textarea name="Sample Preparation" placeholder="Describe preparation"></textarea></label>
                <label>Current Dilution Factor: <textarea name="Dilution Factor" placeholder="Enter dilution factor"></textarea></label>
            </div>
        </div>
    </form>

    <h2>Sample Information</h2>
    <table id="sampleTable">
        <thead>
            <tr>
                <th>Target of Interest</th>
                <th>Sample Species</th>
                <th>Sample Type</th>
                <th>Sample Quantity</th>
                <th>Cartridge of Interest</th>
                <th>Cartridge Cat.No.</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" name="Target1" placeholder="Enter target"></td>
                <td>
                    <select name="Species1">
                        <option value="">Select Species</option>
                        <option value="Human">Human</option>
                        <option value="Mouse">Mouse</option>
                        <option value="Rat">Rat</option>
                        <option value="Non-human Primate">Non-human Primate</option>
                        <option value="Viral Titer">Viral Titer</option>
                        <option value="Impurity Testing">Impurity Testing</option>
                    </select>
                </td>
                <td>
                    <select name="Type1" onchange="toggleOtherInput(this, 'type_other1')">
                        <option value="">Select Sample Type</option>
                        <option value="Serum">Serum</option>
                        <option value="Cell Supernatant">Cell Supernatant</option>
                        <option value="Plasma">Plasma</option>
                        <option value="Others">Others (Please specify)</option>
                    </select>
                    <input type="text" name="Type_Other1" id="type_other1" placeholder="Specify if Others" class="hidden mt-2">
                </td>
                <td><input type="text" name="Quantity1" placeholder="Enter quantity"></td>
                <td><input type="text" name="Cartridge1" placeholder="Enter cartridge"></td>
                <td><input type="text" name="CatNo1" placeholder="Enter catalog number"></td>
                <td><button class="button" onclick="addRow()">Add Row</button></td>
            </tr>
        </tbody>
    </table>
    <button class="button delete" onclick="deleteRow()">Delete Row</button>

    <h2>Note</h2>
    <div class="note-section">
        <p>1. We provide our services from Monday to Thursday between 9:00 AM and 5:00 PM.</p>
        <p>2. Please give us the Simple Plex Services Form before 3 working days for our evaluation.</p>
        <p>3. Please give us a bench which size is more than 37 cm W x 54 cm D x 26 cm H for our Ella system.</p>
        <p>4. Please return the CSV form by email to the Sales Representative.</p>
    </div>

    <button class="button" onclick="saveAsCSV()">Save as CSV</button>

    <footer>
        <p>Medikonia Limited<br>Unit 1005-1006, 10/F, Tower I, Grand Century Place, 193 Prince Edward Road West, Mong Kok, Kowloon, Hong Kong</p>
        <p>Tel: 2866 8995 | Email: <a href="mailto:cs@medikonia.com">cs@medikonia.com</a> | Web: <a href="http://www.medikonia.com">www.medikonia.com</a></p>
    </footer>

    <script>
        const instituteSelect = document.getElementById('institute');
        const instituteOther = document.getElementById('institute_other');
        instituteSelect.addEventListener('change', () => {
            instituteOther.classList.toggle('hidden', instituteSelect.value !== 'Others');
            instituteOther.required = instituteSelect.value === 'Others';
        });

        function toggleOtherInput(select, otherInputId) {
            const otherInput = document.getElementById(otherInputId);
            otherInput.classList.toggle('hidden', select.value !== 'Others');
            otherInput.required = select.value === 'Others';
        }

        let rowCount = 1;

        function addRow() {
            rowCount++;
            const table = document.getElementById('sampleTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" name="Target${rowCount}" placeholder="Enter target"></td>
                <td>
                    <select name="Species${rowCount}">
                        <option value="">Select Species</option>
                        <option value="Human">Human</option>
                        <option value="Mouse">Mouse</option>
                        <option value="Rat">Rat</option>
                        <option value="Non-human Primate">Non-human Primate</option>
                        <option value="Viral Titer">Viral Titer</option>
                        <option value="Impurity Testing">Impurity Testing</option>
                    </select>
                </td>
                <td>
                    <select name="Type${rowCount}" onchange="toggleOtherInput(this, 'type_other${rowCount}')">
                        <option value="">Select Sample Type</option>
                        <option value="Serum">Serum</option>
                        <option value="Cell Supernatant">Cell Supernatant</option>
                        <option value="Plasma">Plasma</option>
                        <option value="Others">Others (Please specify)</option>
                    </select>
                    <input type="text" name="Type_Other${rowCount}" id="type_other${rowCount}" placeholder="Specify if Others" class="hidden mt-2">
                </td>
                <td><input type="text" name="Quantity${rowCount}" placeholder="Enter quantity"></td>
                <td><input type="text" name="Cartridge${rowCount}" placeholder="Enter cartridge"></td>
                <td><input type="text" name="CatNo${rowCount}" placeholder="Enter catalog number"></td>
                <td><button class="button delete" onclick="deleteRow(this)">Delete</button></td>
            `;
        }

        function deleteRow(button) {
            const table = document.getElementById('sampleTable');
            if (table.rows.length > 2) {
                if (button) {
                    const row = button.parentNode.parentNode;
                    row.parentNode.removeChild(row);
                } else {
                    table.deleteRow(-1);
                }
                rowCount--;
                const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
                for (let i = 0; i < rows.length; i++) {
                    const inputs = rows[i].getElementsByTagName('input');
                    const selects = rows[i].getElementsByTagName('select');
                    for (let j = 0; j < inputs.length; j++) {
                        const name = inputs[j].name;
                        if (name) inputs[j].name = name.replace(/\d+/, i + 1);
                    }
                    for (let j = 0; j < selects.length; j++) {
                        const name = selects[j].name;
                        if (name) selects[j].name = name.replace(/\d+/, i + 1);
                    }
                    const otherInput = rows[i].querySelector('input[id^="type_other"]');
                    if (otherInput) otherInput.id = `type_other${i + 1}`;
                }
                rowCount = rows.length;
            } else {
                alert('Cannot delete the last row.');
            }
        }

        function saveAsCSV() {
            const basicForm = document.getElementById('plexForm');
            const evalForm = document.getElementById('evaluationForm');
            const table = document.getElementById('sampleTable').getElementsByTagName('tbody')[0];
            let csv = [];

            // Basic Information
            csv.push('Basic Information');
            csv.push('Field,Value');
            const basicFields = basicForm.querySelectorAll('input, select');
            let serviceId = '', institute = '', givenName = '', surname = '';
            basicFields.forEach(field => {
                if (field.value.trim() && field.name !== 'Institute_Other') {
                    csv.push(`"${field.name.replace(/"/g, '""')}","${field.value.replace(/"/g, '""')}"`);
                    if (field.name === 'Service ID') serviceId = field.value.replace(/[^a-zA-Z0-9-]/g, '');
                    if (field.name === 'Institute') institute = field.value.replace(/[^a-zA-Z0-9]/g, '');
                    if (field.name === 'Given Name') givenName = field.value.replace(/[^a-zA-Z0-9]/g, '');
                    if (field.name === 'Surname') surname = field.value.replace(/[^a-zA-Z0-9]/g, '');
                }
            });
            if (basicForm.querySelector('#institute').value === 'Others' && basicForm.querySelector('#institute_other').value.trim()) {
                csv.push('"Institute_Other","' + basicForm.querySelector('#institute_other').value.replace(/"/g, '""') + '"');
                institute = basicForm.querySelector('#institute_other').value.replace(/[^a-zA-Z0-9]/g, '');
            }
            csv.push('');

            // Evaluation Part
            csv.push('Evaluation Part');
            csv.push('Field,Value');
            const evalFields = evalForm.querySelectorAll('input, textarea');
            evalFields.forEach(field => {
                if (field.value.trim()) {
                    csv.push(`"${field.name.replace(/"/g, '""')}","${field.value.replace(/"/g, '""')}"`);
                }
            });
            csv.push('');

            // Sample Information
            csv.push('Sample Information');
            csv.push('"Target of Interest","Sample Species","Sample Type","Sample Quantity","Cartridge of Interest","Cartridge Cat.No."');
            const rows = table.getElementsByTagName('tr');
            for (let row of rows) {
                const inputs = row.querySelectorAll('input, select');
                const rowData = [];
                inputs.forEach(input => {
                    if (input.name.includes('Type_Other') && !input.value.trim()) return;
                    if (input.value.trim()) {
                        rowData.push(`"${input.value.replace(/"/g, '""')}"`);
                    } else {
                        rowData.push('""');
                    }
                });
                if (rowData.some(val => val !== '""')) csv.push(rowData.join(','));
            }

            // Download CSV with dynamic filename
            const filename = `${serviceId}_${institute}_${givenName}_${surname}.csv`;
            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename || 'Simple_Plex_Services_Form.csv';
            link.click();
            URL.revokeObjectURL(link.href);
        }
    </script>
</body>
</html>
